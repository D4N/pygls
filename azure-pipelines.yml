############################################################################
# Copyright(c) Open Law Library. All rights reserved.                      #
# See ThirdPartyNotices.txt in the project root for additional notices.    #
#                                                                          #
# Licensed under the Apache License, Version 2.0 (the "License")           #
# you may not use this file except in compliance with the License.         #
# You may obtain a copy of the License at                                  #
#                                                                          #
#     http: // www.apache.org/licenses/LICENSE-2.0                         #
#                                                                          #
# Unless required by applicable law or agreed to in writing, software      #
# distributed under the License is distributed on an "AS IS" BASIS,        #
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. #
# See the License for the specific language governing permissions and      #
# limitations under the License.                                           #
############################################################################

strategy:
  matrix:
    Python3.5 on linux:
      python.version: "3.5"
      imageName: "ubuntu-18.04"
    Python3.6 on linux:
      python.version: "3.6"
      imageName: "ubuntu-18.04"
    Python3.7 on linux:
      python.version: "3.7"
      imageName: "ubuntu-18.04"
    Python3.8 on linux:
      python.version: "3.8"
      imageName: "ubuntu-18.04"
    Python3.5 on windows:
      python.version: "3.5"
      imageName: "windows-2019"
    Python3.6 on windows:
      python.version: "3.6"
      imageName: "windows-2019"
    Python3.7 on windows:
      python.version: "3.7"
      imageName: "windows-2019"
    Python3.8 on windows:
      python.version: "3.8"
      imageName: "windows-2019"

pool:
  vmImage: $(imageName)

steps:
  - task: UsePythonVersion@0
    inputs:
      versionSpec: "$(python.version)"
    displayName: "Use Python $(python.version)"

  - script: |
      python -m pip install --upgrade pip tox setuptools
    displayName: "Install python dependencies"

  - script: tox -e py
    displayName: "tox"

  - bash: |
      cd examples/json-extension
      # install extension-wide js dependencies
      npm install --save-dev
      # run tslint
      npx tslint client/src/*.ts
      # install our dependencies
      npm install # TODO: replace with `yarn install`
      npm run compile

      # check to see if key files will be in the `.vsix` package to be built
      npx vsce ls | grep package.json
      npx vsce ls | grep out/extension.js
      npx vsce ls | grep server/__init__.py
      npx vsce ls | grep server/__main__.py
      npx vsce ls | grep server/server.py
    displayName: "build and check sample extension"

  - script: |
      python --version
      node --version
      npm --version
    displayName: "Output versions for debugging"
